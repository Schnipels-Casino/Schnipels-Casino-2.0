<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
  <title>Friends Bank ‚Äì Mobile v3.3 + Jackpot + CSGO</title>
  <meta name="theme-color" content="#ffffff">
  <style>
    :root{
      --bg:#f6f8fc; --card:#ffffff; --muted:#566074; --text:#0f1624;
      --accent:#2dd36f; --accent2:#2563eb; --danger:#e11d48; --warn:#f59e0b;
      --outline:#e4e8f1; --pill:#eff3f9; --win:#16a34a; --loss:#dc2626;
      --shadow:0 8px 28px rgba(15,22,36,.08);
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;font-size:17px;line-height:1.5;letter-spacing:.2px;
      -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}
    .hidden{display:none!important}
    .row{display:flex;gap:.8rem;align-items:center}
    .col{display:flex;flex-direction:column;gap:.8rem}
    .between{justify-content:space-between}
    .center{justify-content:center;align-items:center}
    .container{max-width:880px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--outline);border-radius:18px;padding:16px;box-shadow:var(--shadow)}
    .btn{background:var(--pill);border:1px solid var(--outline);padding:1rem 1.15rem;border-radius:14px;min-width:48px;min-height:48px;font-weight:800;color:var(--text);cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn.primary{background:var(--accent);color:#052010;border-color:#129454}
    .btn.warn{background:var(--warn);color:#231a00;border-color:#b07404}
    .btn.danger{background:#f43f5e;color:#2b0d0d;border-color:#d11a44}
    input,select{width:100%;background:#f2f5fb;color:var(--text);border:1px solid var(--outline);border-radius:12px;padding:1rem 1rem;font-size:18px}
    label{font-size:1rem;color:#24324a;font-weight:800}
    small{color:var(--muted);font-size:.98rem}
    ::placeholder{color:#6b7280;opacity:.9}
    .topbar{position:sticky;top:0;z-index:50;background:#ffffffee;border-bottom:1px solid var(--outline);padding:.6rem .9rem;backdrop-filter:saturate(1.3) blur(6px);box-shadow:0 6px 18px rgba(15,22,36,.06)}
    .top-grid{display:grid;grid-template-columns:110px 1fr 160px;gap:.6rem;align-items:center}
    .circle{width:48px;height:48px;border-radius:999px;background:var(--pill);border:1px solid var(--outline);display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:900;cursor:pointer}
    #screen{padding:14px;display:flex;flex-direction:column;gap:14px;padding-bottom:110px}
    .tabs{display:flex;gap:.6rem}
    .tab{flex:1;padding:.9rem;border:1px solid var(--outline);background:var(--pill);border-radius:12px;text-align:center;font-weight:900;cursor:pointer}
    .tab.active{background:var(--accent2);color:#fff;border-color:#1e4fd5}
    .section-title{font-size:1.2rem;font-weight:1000}
    .strip{display:flex;gap:.6rem;overflow:auto;padding-bottom:.2rem}
    .grid2{display:grid;grid-template-columns:1fr;gap:.8rem}
    .grid3{display:grid;grid-template-columns:1fr;gap:.8rem}
    .gridAuto{display:grid;grid-template-columns:1fr;gap:.8rem}
    @media (min-width:720px){.grid2{grid-template-columns:1fr 1fr}.grid3{grid-template-columns:repeat(3,1fr)}.gridAuto{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}}
    .toast{position:fixed;bottom:14px;left:0;right:0;margin:auto;max-width:560px;padding:1rem 1.1rem;border-radius:12px;background:#0f1624;color:#fff;border:1px solid #1f2a40;box-shadow:0 10px 30px rgba(15,22,36,.25);text-align:center}
    .modal{position:fixed;inset:0;background:rgba(15,22,36,.4);display:none;align-items:flex-end}
    .sheet{background:var(--card);border-top-left-radius:18px;border-top-right-radius:18px;width:100%;max-height:88vh;overflow:auto;border-top:1px solid var(--outline);box-shadow:0 -10px 24px rgba(15,22,36,.08)}
    .sheet .handle{width:54px;height:6px;background:#d9deea;border-radius:100px;margin:10px auto}
    .chat-bubble{padding:.7rem .9rem;border-radius:12px;border:1px solid var(--outline);max-width:85%;background:#f7faff}
    .mine{background:#e5ffe5;border-color:#c7f3c7}
    .slot-grid{display:grid;grid-template-columns:repeat(3,74px);grid-auto-rows:74px;gap:10px;justify-content:center;align-content:center}
    .slot-cell{display:flex;align-items:center;justify-content:center;border:2px solid var(--outline);border-radius:12px;background:#f2f6ff;font-size:30px;transition:transform .12s;box-shadow:var(--shadow)}
    .slot-cell.spin{transform:scale(1.05)}
    footer.nav{position:fixed;left:0;right:0;bottom:0;padding:.6rem;background:#ffffffee;border-top:1px solid var(--outline);display:grid;grid-template-columns:repeat(4,1fr);gap:.6rem;backdrop-filter:saturate(1.2) blur(6px)}
    .bank-choice .btn{border-width:2px}
    .bank-choice .btn.active{background:#e8f7ff;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.18) inset}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="container">
      <div class="top-grid">
        <div class="row" style="gap:.6rem">
          <div id="btnBank" class="circle" title="Bank w√§hlen">üí∂</div>
          <div class="col">
            <div style="font-weight:1000;font-size:1.05rem" id="bankLabel">Keine Bank gew√§hlt</div>
            <small class="money" id="acctBalance">‚Äî</small>
          </div>
        </div>
        <div class="center">
          <button id="btnChat" class="btn" style="padding:.65rem 1rem;">üí¨ Chat</button>
        </div>
        <div class="row" style="gap:.5rem;justify-content:flex-end">
          <div class="col" style="align-items:flex-end">
            <div class="small" style="opacity:.9">Bargeld</div>
            <div id="cashLabel" class="money" style="font-size:1.05rem">‚Ç¨0</div>
          </div>
          <div id="btnSlots" class="circle" title="Slots">üé∞</div>
          <div id="btnHouse" class="circle" title="H√§user">üè†</div>
        </div>
      </div>
    </div>
  </div>

  <main id="screen" class="container">
    <div id="welcome" class="card">
      <div class="section-title">Willkommen üëã</div>
      <p>Tippe links oben auf <b>üí∂</b>, w√§hle deine Bank & logge dich mit <b>Name + Passwort</b> ein.</p>
      <div class="grid2">
        <div class="card">
          <div class="section-title">T√§gliches Bonusgeld</div>
          <p>Jede Bank zahlt <b>‚Ç¨500 / Tag</b>. Startguthaben: <b>‚Ç¨1.500</b>.</p>
          <button id="btnClaimDaily" class="btn primary">‚Ç¨500 jetzt abholen</button>
        </div>
        <div class="card">
          <div class="section-title">Leihen & Kredit</div>
          <ul style="margin:.2rem 0 .2rem 1rem">
            <li>Leihen: <b>‚Ç¨1.000/Tag</b>, max. <b>‚Ç¨10.000</b>, <b>10% Zinsen</b>.</li>
            <li>Kredit: bis <b>‚Ç¨100.000</b>, mind. <b>‚Ç¨1.000/Tag</b> R√ºckzahlung.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Bank -->
    <div id="bankArea" class="card">
      <div class="section-title">Dein Konto</div>
      <div class="grid2">
        <div class="card">
          <div class="row between"><div>Kontostand</div><div class="money" id="bankBalance">‚Ç¨0</div></div>
          <div class="row between"><div>Leihe offen</div><div class="money" id="loanOutstanding">‚Ç¨0</div></div>
          <div class="row between"><div>Kredit offen</div><div class="money" id="creditOutstanding">‚Ç¨0</div></div>
        </div>
        <div class="card">
          <div class="row between"><div>Aktienkurs <span id="stockBankName" class="small"></span></div><div class="ticker" id="stockPrice">‚Äî</div></div>
          <div class="row between"><div>Deine Anteile</div><div id="userShares">0</div></div>
        </div>
      </div>
      <div class="card">
        <div class="section-title">Verlauf</div>
        <div id="feed" style="max-height:38vh;overflow:auto"></div>
      </div>
    </div>

    <!-- Slots -->
    <div id="slotsArea" class="card hidden">
      <div class="section-title">Slots üé∞</div>
      <small>Eins√§tze: 5 / 10 / 30 / 50 / 80 / 100 ‚Ç¨ (vom Bargeld)</small>

      <div class="card">
        <div class="row between"><div class="section-title">Triple Chance + Jackpot</div><div id="tcStatus"></div></div>
        <div class="center" style="margin:.4rem 0">
          <div class="slot-grid" id="slotGrid">
            <div class="slot-cell">üçã</div><div class="slot-cell">üçí</div><div class="slot-cell">üçÄ</div>
            <div class="slot-cell">‚≠ê</div><div class="slot-cell">üîî</div><div class="slot-cell">7Ô∏è‚É£</div>
            <div class="slot-cell">üçâ</div><div class="slot-cell">üçã</div><div class="slot-cell">üçí</div>
          </div>
        </div>
        <div class="row center" style="gap:.6rem">
          <select id="stakeTC"><option>5</option><option>10</option><option>30</option><option>50</option><option>80</option><option>100</option></select>
          <button id="btnSpin" class="btn">Spin</button>
          <button id="btnAuto10" class="btn">Auto x10</button>
        </div>
        <div class="row between" style="margin-top:.5rem">
          <div>üí∞ Jackpot:</div>
          <div id="jackpotAmount">‚Ç¨0</div>
        </div>
      </div>
    </div>

    <!-- CS:GO Case -->
    <div id="csgoArea" class="card hidden">
      <div class="section-title">CS:GO Kiste üéÅ</div>
      <small>Kisten-ID: <b>case_csg_001</b></small>
      <p>Kosten: 20 ‚Ç¨ (Bargeld). 10 ‚Ç¨ an die Bank, 10 ‚Ç¨ in Jackpot.</p>
      <div class="row center" style="gap:.6rem">
        <button id="btnOpenCase" class="btn primary">Kiste √∂ffnen</button>
      </div>
      <div id="csgoResult" class="section-title" style="text-align:center;margin-top:.6rem">‚Äî</div>
    </div>

    <!-- H√§user -->
    <div id="houseArea" class="card hidden">
      <div class="section-title">H√§user & Mieten üè†</div>
      <div class="gridAuto" id="houseList"></div>
      <div class="row between">
        <button id="btnCollectRent" class="btn primary">Tagesmieten einsammeln</button>
        <small id="rentInfo"></small>
      </div>
    </div>

    <!-- Chat -->
    <div id="chatArea" class="card hidden">
      <div class="row tabs">
        <div id="tabGlobal" class="tab active">Global</div>
        <div id="tabPrivate" class="tab">Privat</div>
      </div>
      <div id="chatGlobal" class="col">
        <div id="globalList" style="max-height:38vh;overflow:auto"></div>
        <div class="row"><input id="globalMsg" placeholder="Nachricht an alle‚Ä¶"><button id="sendGlobal" class="btn primary">Senden</button></div>
      </div>
      <div id="chatPrivate" class="col hidden">
        <div class="row"><input id="pmTo" placeholder="Empf√§nger (Name)"></div>
        <div id="privateList" style="max-height:38vh;overflow:auto"></div>
        <div class="row"><input id="privateMsg" placeholder="Deine private Nachricht‚Ä¶"><button id="sendPrivate" class="btn primary">Senden</button></div>
      </div>
    </div>
  </main>

  <footer class="nav">
    <div class="container" style="display:grid;grid-template-columns:repeat(5,1fr);gap:.6rem">
      <button id="navBank"  class="btn">üí∂ Bank</button>
      <button id="navSlots" class="btn">üé∞ Slots</button>
      <button id="navCSGO"  class="btn">üéÅ CSGO</button>
      <button id="navHouse" class="btn">üè† H√§user</button>
      <button id="navChat"  class="btn">üí¨ Chat</button>
    </div>
  </footer>

  <div id="toast" class="toast hidden"></div>
  <script>
    // ===== Utils =====
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    const sleep = (ms)=> new Promise(r=>setTimeout(r,ms));
    const EUR = (n)=> "‚Ç¨"+(Math.round(n*100)/100).toLocaleString("de-DE",{minimumFractionDigits:2, maximumFractionDigits:2});
    const todayKey = ()=> new Date().toLocaleDateString("de-DE",{ timeZone:"Europe/Berlin" });

    // ===== Persistenter State (ohne Backend) =====
    const LSKEY = "friendsbank_v33";
    const defaults = {
      bankFunds: 1_000_000_000,
      bankBalance: 1500,
      cash: 0,
      jackpot: 0,
      lastDaily: "",
      houses: {},     // { h1: Anzahl, ... }
      lastRent: "",
    };
    let state = loadState();

    function loadState(){
      try{
        const raw = localStorage.getItem(LSKEY);
        if (!raw) return { ...defaults };
        const parsed = JSON.parse(raw);
        return { ...defaults, ...parsed };
      }catch{ return { ...defaults }; }
    }
    function saveState(){
      localStorage.setItem(LSKEY, JSON.stringify(state));
      drawHeader();
      drawBank();
      drawJackpot();
      drawHouses();
    }

    // ===== UI Refs =====
    const toast = $("#toast");
    const bankBalanceEl = $("#bankBalance");
    const acctBalanceEl = $("#acctBalance");
    const cashLabelEl = $("#cashLabel");
    const bankFundsEl = $("#bankFunds");
    const stockPriceEl = $("#stockPrice"); // pseudo-ticker
    const stockBankName = $("#stockBankName");
    const jackpotEl = $("#jackpotAmount");
    const feedEl = $("#feed");

    function showToast(msg, ms=1600){
      toast.textContent = msg;
      toast.classList.remove("hidden");
      setTimeout(()=> toast.classList.add("hidden"), ms);
    }

    // ===== Header / Areas =====
    function drawHeader(){
      acctBalanceEl.textContent = "Konto ‚Ä¢ "+EUR(state.bankBalance);
      cashLabelEl.textContent = EUR(state.cash);
    }
    function drawBank(){
      bankBalanceEl.textContent = EUR(state.bankBalance);
      bankFundsEl && (bankFundsEl.textContent = EUR(state.bankFunds));
    }
    function drawJackpot(){
      jackpotEl && (jackpotEl.textContent = EUR(state.jackpot));
    }
    function logFeed(txt){
      if(!feedEl) return;
      const line = document.createElement("div");
      line.textContent = "‚Ä¢ "+txt;
      feedEl.prepend(line);
    }
    function showArea(id){
      ["bankArea","slotsArea","csgoArea","houseArea","chatArea"].forEach(x=> $("#"+x).classList.add("hidden"));
      $("#"+id).classList.remove("hidden");
    }
    // Footer-Navigation
    $("#navBank").onclick  = ()=> showArea("bankArea");
    $("#navSlots").onclick = ()=> showArea("slotsArea");
    $("#navCSGO").onclick  = ()=> showArea("csgoArea");
    $("#navHouse").onclick = ()=> showArea("houseArea");
    $("#navChat").onclick  = ()=> showArea("chatArea");
    // Topbar Shortcuts
    $("#btnSlots").onclick = ()=> showArea("slotsArea");
    $("#btnHouse").onclick = ()=> showArea("houseArea");
    $("#btnChat").onclick  = ()=> showArea("chatArea");

    // ===== Daily Bonus =====
    $("#btnClaimDaily").onclick = ()=>{
      const today = todayKey();
      if (state.lastDaily === today){ showToast("Heute schon abgeholt."); return; }
      state.bankBalance += 500;
      state.lastDaily = today;
      logFeed("Tagesbonus +‚Ç¨500");
      saveState();
      showToast("Tagesbonus gutgeschrieben.");
    };

    // ===== Quick ‚ÄûBank ‚Üí Bargeld‚Äú und zur√ºck (optional Touch) =====
    // Tipp: Tippe auf Kontostand (links) um ‚Ç¨100 auszuzahlen, auf Bargeld (rechts) f√ºr ‚Ç¨100 einzuzahlen.
    bankBalanceEl.parentElement.onclick = ()=>{
      // Auszahlung 100 ‚Ç¨
      if (state.bankBalance < 100){ showToast("Zu wenig Guthaben."); return; }
      state.bankBalance -= 100;
      state.cash += 100;
      state.bankFunds -= 100; // Bank zahlt aus
      logFeed("Auszahlung: ‚Ç¨100 (Bargeld +‚Ç¨100)");
      saveState();
    };
    cashLabelEl.parentElement.onclick = ()=>{
      // Einzahlung 100 ‚Ç¨
      if (state.cash < 100){ showToast("Zu wenig Bargeld."); return; }
      state.cash -= 100;
      state.bankBalance += 100;
      state.bankFunds += 100; // Bank nimmt ein
      logFeed("Einzahlung: ‚Ç¨100 (Bargeld -‚Ç¨100)");
      saveState();
    };

    // ===== Pseudo ‚ÄûAktien‚Äú-Ticker (nur Anzeige) =====
    let lastTicker = Date.now(), pseudoPrice = 100;
    stockBankName && (stockBankName.textContent = "(Friends Bank)");
    setInterval(()=>{
      const now = Date.now();
      if (now - lastTicker < 12_000) return;
      lastTicker = now;
      const dir = Math.random() < 0.5 ? -1 : 1;
      const pct = (0.004 + Math.random()*0.008)*dir;
      pseudoPrice = Math.max(5, Math.round(pseudoPrice*(1+pct)*100)/100);
      stockPriceEl && (stockPriceEl.textContent = EUR(pseudoPrice));
    }, 2000);

    // ===== H√§user =====
    const HOUSES = [
      { id:"h1", name:"Klein Familien Haus", price:50_000,  rent:2_500 },
      { id:"h2", name:"Mittel Familien Haus", price:75_000,  rent:4_000 },
      { id:"h3", name:"Gro√ü Familien Haus",   price:100_000, rent:6_000 },
      { id:"h4", name:"Dubai Villa",          price:450_000, rent:15_000 },
      { id:"h5", name:"Luxus Villa",          price:1_000_000, rent:50_000 },
    ];
    function drawHouses(){
      const wrap = $("#houseList"); if(!wrap) return;
      wrap.innerHTML = "";
      HOUSES.forEach(h=>{
        const owned = state.houses[h.id] || 0;
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <div class="section-title">${h.name}</div>
          <div class="row between"><small>Preis</small><b>${EUR(h.price)}</b></div>
          <div class="row between"><small>Miete/Tag</small><b>${EUR(h.rent)}</b></div>
          <div class="row between"><small>Besitz</small><b>${owned}</b></div>
          <div class="row grid2" style="margin-top:.4rem">
            <button class="btn" data-buy="${h.id}">Kaufen</button>
            <button class="btn" data-sell="${h.id}" ${owned? "": "disabled"}>Verkaufen</button>
          </div>`;
        wrap.appendChild(el);
      });
      $$("#houseList [data-buy]").forEach(b=> b.onclick = ()=> buyHouse(b.dataset.buy));
      $$("#houseList [data-sell]").forEach(b=> b.onclick = ()=> sellHouse(b.dataset.sell));
      const ri = $("#rentInfo");
      if(ri) ri.textContent = state.lastRent ? ("Letzte Miete: "+state.lastRent) : "Noch keine Miete kassiert";
    }
    function buyHouse(hid){
      const h = HOUSES.find(x=>x.id===hid); if(!h) return;
      if (state.bankBalance < h.price){ showToast("Zu wenig Guthaben."); return; }
      state.bankBalance -= h.price;
      state.bankFunds += h.price;
      state.houses[hid] = (state.houses[hid]||0)+1;
      logFeed(`Gekauft: ${h.name} (${EUR(h.price)})`);
      saveState();
    }
    function sellHouse(hid){
      const h = HOUSES.find(x=>x.id===hid); if(!h) return;
      if (!state.houses[hid]){ showToast("Kein Besitz."); return; }
      const refund = Math.round(h.price * 0.8);
      state.houses[hid]--;
      state.bankBalance += refund;
      state.bankFunds -= refund;
      logFeed(`Verkauft: ${h.name} (${EUR(refund)})`);
      saveState();
    }
    $("#btnCollectRent").onclick = ()=>{
      const today = todayKey();
      if (state.lastRent === today){ showToast("Heute schon kassiert."); return; }
      let total = 0;
      HOUSES.forEach(h=> total += (state.houses[h.id]||0)*h.rent);
      if (total<=0){ showToast("Keine H√§user im Besitz."); return; }
      state.bankBalance += total;
      state.bankFunds -= total;
      state.lastRent = today;
      logFeed(`Tagesmieten +${EUR(total)}`);
      saveState();
      showToast("Mieten eingesammelt.");
    };

    // ===== Slots: Triple Chance + Jackpot =====
    const SYMBOLS = ["üçã","üçí","üçá","üçÄ","‚≠ê","üîî","7Ô∏è‚É£"]; // 7 Symbole (h√∂here Jackpot-Chance)
    const slotGrid = $$("#slotGrid .slot-cell");
    const tcStatus = $("#tcStatus");
    const stakeSelTC = $("#stakeTC");
    const btnSpin = $("#btnSpin");
    const btnAuto10 = $("#btnAuto10");

    let lastSpinAt = 0;
    const SPIN_DELAY = 2000; // Anti-Spam: alle 2s

    function drawJackpot(){ jackpotEl.textContent = EUR(state.jackpot); }

    function canSpinNow(){
      const now = Date.now();
      return (now - lastSpinAt) >= SPIN_DELAY;
    }
    function lockSpinForDelay(){
      lastSpinAt = Date.now();
      btnSpin.disabled = true;
      btnAuto10.disabled = true;
      setTimeout(()=>{ btnSpin.disabled=false; btnAuto10.disabled=false; }, SPIN_DELAY);
    }
    function requireCash(amount){
      if (state.cash < amount){
        showToast("Nicht genug Bargeld. Tippe links auf Kontostand, um auszuzahlen.");
        return false;
      }
      return true;
    }
    function slotPaylines(picks){
      const L = [[0,1,2],[3,4,5],[6,7,8],[0,4,8],[6,4,2]];
      let wins = 0;
      L.forEach(line=>{
        const [a,b,c] = line.map(i=>picks[i]);
        if (a===b && b===c) wins++;
      });
      return wins;
    }
    function fullGridSame(picks){
      return picks.every(p => p===picks[0]);
    }
    function spinOnceInternal(stake){
      // Einsatz abbuchen: H√§lfe Bank, H√§lfte Jackpot
      state.cash -= stake;
      state.bankFunds += stake/2;
      state.jackpot += stake/2;

      // Rollen
      const picks = [];
      for (let i=0;i<9;i++){
        const sym = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
        picks.push(sym);
      }
      // Animation Light
      (async ()=>{
        for (let i=0;i<9;i++){
          slotGrid[i].classList.add("spin");
          slotGrid[i].textContent = picks[i];
          await sleep(40);
          slotGrid[i].classList.remove("spin");
        }
      })();

      // Gewinn
      let payout = 0;
      const wins = slotPaylines(picks);
      if (wins>0) payout += stake*3*wins;

      if (fullGridSame(picks)){
        payout += state.jackpot;
        if (state.jackpot>0) logFeed("üéâ JACKPOT gewonnen: "+EUR(state.jackpot));
        state.jackpot = 0;
      }

      if (payout>0){
        state.cash += payout;
        tcStatus.textContent = `Gewinn ${EUR(payout)}${wins?` (${wins} Linie${wins>1?"n":""})`:""}`;
      }else{
        tcStatus.textContent = `Verlust ${EUR(stake)}`;
      }

      drawHeader(); drawBank(); drawJackpot(); saveState();
      setTimeout(()=> tcStatus.textContent="", 1400);
    }

    btnSpin.onclick = async ()=>{
      const stake = Number(stakeSelTC.value)||5;
      if (!canSpinNow()){ showToast("Bitte kurz warten‚Ä¶"); return; }
      if (!requireCash(stake)) return;
      lockSpinForDelay();
      spinOnceInternal(stake);
    };

    btnAuto10.onclick = async ()=>{
      const baseStake = Number(stakeSelTC.value)||5;
      if (!canSpinNow()){ showToast("Bitte kurz warten‚Ä¶"); return; }
      lockSpinForDelay();
      for(let i=0;i<10;i++){
        const stake = baseStake;
        if (!requireCash(stake)) break;
        spinOnceInternal(stake);
        await sleep(160); // kurze Animationszeit
      }
    };

    // ===== CS:GO Case (case_csg_001) =====
    const CSGO_ID = "case_csg_001";
    const btnOpenCase = $("#btnOpenCase");
    const csgoResult = $("#csgoResult");

    btnOpenCase.onclick = ()=>{
      const cost = 20; // 10 ‚Ç¨ Bank, 10 ‚Ç¨ Jackpot
      if (!requireCash(cost)) return;

      state.cash -= cost;
      state.bankFunds += 10;
      state.jackpot += 10;

      // Beispiel-Loot (mit Werten, einige nur kosmetisch)
      const table = [
        { label:"üé≤ Sticker",      weight: 45, value: 0   },
        { label:"üî´ Skin Blau",    weight: 35, value: 10  },
        { label:"üí† Skin Lila",    weight: 12, value: 20  },
        { label:"üü™ Skin Pink",    weight: 6,  value: 40  },
        { label:"üíé Rare Item",    weight: 1.9, value: 120 },
        { label:"üî™ Messer",       weight: 0.1, value: 300 },
      ];
      const totalW = table.reduce((s,x)=>s+x.weight,0);
      let roll = Math.random()*totalW, pick = table[0];
      for(const it of table){ roll -= it.weight; if(roll<=0){ pick = it; break; } }

      if (pick.value>0){
        state.cash += pick.value;               // Gewinn geht in Bargeld
        state.bankFunds -= pick.value;          // Bank zahlt Gewinn aus
        csgoResult.textContent = `Gewinn: ${pick.label} (+${EUR(pick.value)})`;
        logFeed(`CS:GO (${CSGO_ID}): ${pick.label} (+${EUR(pick.value)})`);
      }else{
        csgoResult.textContent = `Erhalten: ${pick.label}`;
        logFeed(`CS:GO (${CSGO_ID}): ${pick.label}`);
      }

      drawHeader(); drawBank(); drawJackpot(); saveState();
    };

    // ===== Initial Draw =====
    function init(){
      drawHeader();
      drawBank();
      drawJackpot();
      drawHouses();
      // Startbildschirm
      showArea("bankArea");
      // Setze kleine Hinweise
      $("#bankLabel").textContent = "Friends Bank";
      $("#btnChat").title = "Chat";
    }
    init();
  </script>
</body>
</html>
